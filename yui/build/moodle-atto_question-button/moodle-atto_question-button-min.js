YUI.add("moodle-atto_question-button",function(e,t){var n="atto_question",r="question_link",i="question_number",s="display_mode",o="atto_question",u={INPUTSUBMIT:"atto_media_urlentrysubmit",INPUTCANCEL:"atto_media_urlentrycancel",TEXTLINKCONTROL:"textlinkcontrol",QUESTIONIDCONTROL:"questionidcontrol",DISPLAYMODECONTROL:"displaymodecontrol"},a={TEXTLINKCONTROL:".textlinkcontrol",QUESTIONIDCONTROL:".questionidcontrol",DISPLAYMODECONTROL:".displaymodecontrol"},f='<form class="atto_form"><div id="{{elementid}}_{{innerform}}" class="mdl-align"><label for="{{elementid}}_{{TEXTLINKCONTROL}}">{{get_string "enterlinktext" component}}</label><input class="{{CSS.TEXTLINKCONTROL}}" id="{{elementid}}_{{TEXTLINKCONTROL}}" name="{{elementid}}_{{TEXTLINKCONTROL}}" value="{{defaulttextlink}}" /><label for="{{elementid}}_{{QUESTIONIDCONTROL}}">{{get_string "enterquestionid" component}}</label><input class="{{CSS.QUESTIONIDCONTROL}}" id="{{elementid}}_{{QUESTIONIDCONTROL}}" name="{{elementid}}_{{QUESTIONIDCONTROL}}" value="{{defaultquestionid}}" /><label for="{{elementid}}_{{DISPLAYMODECONTROL}}">{{get_string "enterdisplaymode" component}}</label><input class="{{CSS.DISPLAYMODECONTROL}}" id="{{elementid}}_{{DISPLAYMODECONTROL}}" name="{{elementid}}_{{DISPLAYMODECONTROL}}" value="{{defaultdisplaymode}}" /><br /><br /><button class="{{CSS.INPUTSUBMIT}}">{{get_string "insert" component}}</button></div></form>';e.namespace("M.atto_question").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){if(this.get("disabled"))return;var t=["iconone"];e.Array.each(t,function(e){this.addButton({icon:"ed/"+t,iconComponent:"atto_question",buttonName:e,callback:this._displayDialogue,callbackArgs:e})},this)},_getTextLinkControlName:function(){return this.get("host").get("elementid")+"_"+r},_displayDialogue:function(t,r){t.preventDefault();var i=400,s=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:i+"px",focusAfterHide:r});s.width!==i+"px"&&s.set("width",i+"px");var o=this._getFormContent(r),u=e.Node.create("<div></div>");u.append(o),s.set("bodyContent",u),s.show(),this.markUpdated()},_getFormContent:function(t){var s=e.Handlebars.compile(f),o=e.Node.create(s({elementid:this.get("host").get("elementid"),CSS:u,TEXTLINKCONTROL:r,component:n,defaultflavor:this.get("defaulttextlink"),QUESTIONIDCONTROL:i,component:n,defaultflavor:this.get("defaultquestionid")}));return this._form=o,this._form.one("."+u.INPUTSUBMIT).on("click",this._doInsert,this),o},_doInsert:function(e){e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();var t=this._form.one(a.TEXTLINKCONTROL),n=t.get("value");if(!n)return;var r=this._form.one(a.QUESTIONIDCONTROL),i=r.get("value");if(!i)return;var s=/^\d+$/.test(i);if(!s)return;var o=this._form.one(a.DISPLAYMODECONTROL),u=o.get("value");if(!u)return;if(u!="embed"&&u!="popup")return;var f="{QUESTION:"+n+"|"+i+"|"+u+"}";this.editor.focus(),this.get("host").insertContentAtFocusPoint(f),this.markUpdated()}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},defaultlinktext:{value:""}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
